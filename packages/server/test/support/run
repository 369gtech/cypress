SPEC="$1"
BROWSER="$2"

if [ "$SPEC" = '' ]; then
  echo 'Error: A path to a spec file must be specified!'
  echo ''
  echo 'It should look something like this:'
  echo ''
  echo '  $ npm test ./test/unit/api_spec.coffee'
  echo ''
  echo 'If you want to run all a specific group of tests:'
  echo ''
  echo '  $ npm run test-unit'
  echo '  $ npm run test-integration'
  echo '  $ npm run test-e2e'
  echo ''
  exit 1
fi

CYPRESS_DEBUG=true \
NODE_ENV=test \
NODE_DEBUG=request \
CYPRESS_ENV=test \
BLUEBIRD_DEBUG=1 \
DEBUG=$DEBUG,nock.*,-nock.common,-nock.scope,socket.io:*,xvfb-maybe \
BROWSER=$BROWSER \
xvfb-maybe --xvfb-run-args "-s \"-screen 0 1280x1024x8\"" mocha $SPEC \
--fgrep "$FGREP" \
--timeout 10000 \
--recursive \
--compilers ts:@packages/ts/register,coffee:@packages/coffee/register \
--reporter mocha-multi-reporters \
--reporter-options configFile=../../mocha-reporter-config.json
